@page "/"
@using SecureHR.Shared.Models
@using SecureHR.WebUI.Components.QuickActionGrid
@using SecureHR.WebUI.wwwroot.Shared

<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-slate-800">Dashboard</h2>
        <p class="text-slate-500 mt-1">Welcome back, Jane. Here's your security-focused overview for today.</p>
    </div>

    <!-- Security Checkpoint -->
    <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded-r-lg mb-8 flex items-center justify-between shadow-sm">
        <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 mr-3 text-red-600"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" x2="12" y1="9" y2="13"></line><line x1="12" x2="12.01" y1="17" y2="17"></line></svg>
            <div>
                <p class="font-bold">Action Required: Security Checkpoint</p>
                <p class="text-sm">Your quarterly security review is due. Please review your account settings to maintain compliance.</p>
            </div>
        </div>
        <button class="bg-red-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">Review Security</button>
    </div>

    <QuickActionsGrid Cards="@actionCards" />

    <!-- Main Data Tables -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- My Team Overview -->
        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm">
            <h3 class="text-lg font-semibold text-slate-800 mb-4">My Team Overview</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500">
                    <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Name</th>
                            <th scope="col" class="px-6 py-3">Role</th>
                            <th scope="col" class="px-6 py-3">Status</th>
                            <th scope="col" class="px-6 py-3">Pending Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-white border-b hover:bg-slate-50">
                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">John Smith</td>
                            <td class="px-6 py-4">Senior Software Engineer</td>
                            <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Active</span></td>
                            <td class="px-6 py-4 text-green-600 font-semibold">Review Due</td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-slate-50">
                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">Maria Garcia</td>
                            <td class="px-6 py-4">UX/UI Designer</td>
                            <td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">On Leave</span></td>
                            <td class="px-6 py-4">None</td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-slate-50">
                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">David Chen</td>
                            <td class="px-6 py-4">Project Manager</td>
                            <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Active</span></td>
                            <td class="px-6 py-4 text-green-600 font-semibold">2 Approvals</td>
                        </tr>
                        <tr class="bg-white hover:bg-slate-50">
                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">Aisha Khan</td>
                            <td class="px-6 py-4">Junior Developer</td>
                            <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Active</span></td>
                            <td class="px-6 py-4">None</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Security Logs -->
        <SecurityLog Title="Recent Security Activity" Logs="@securityLogs" />
    </div>
</div>

@code {
    private List<SecurityDetails> securityLogs = new()
    {
        new SecurityDetails
        {
            Type = SecurityLogType.SuccessfulLogin,
            Title = "Successful Login",
            Description = "19:05 PM BST from 82.34.56.78",
            Timestamp = DateTime.Now.AddHours(-1)
        },
        new SecurityDetails
        {
            Type = SecurityLogType.MFAChallenge,
            Title = "MFA Challenge Passed",
            Description = "19:05 PM BST via Authenticator App",
            Timestamp = DateTime.Now.AddHours(-1)
        },
        new SecurityDetails
        {
            Type = SecurityLogType.ViewedDocument,
            Title = "Viewed Document",
            Description = "'Employee Handbook 2025.pdf'",
            Timestamp = DateTime.Now.AddHours(-2)
        },
        new SecurityDetails
        {
            Type = SecurityLogType.ExportedReport,
            Title = "Exported Report",
            Description = "'Q3_Payroll_Summary.csv'",
            Timestamp = DateTime.Now.AddHours(-3)
        }
    };

    private List<ActionCardModel> actionCards = new();

    protected override void OnInitialized()
    {
        RenderFragment onboardIcon = @<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" x2="19" y1="8" y2="14"></line><line x1="22" x2="16" y1="11" y2="11"></line></svg>;
        RenderFragment approveIcon = @<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        RenderFragment reportIcon = @<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="m10 13-2 2 2 2"></path><path d="m14 17 2-2-2-2"></path></svg>;
        RenderFragment settingsIcon = @<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>;

        actionCards = new List<ActionCardModel>
        {
            new ActionCardModel { Title = "Onboard New Hire", Subtitle = "Start the process", IconSvg = onboardIcon, IconBgCssClass = "bg-green-100", IconColorCssClass = "text-green-600" },
            new ActionCardModel { Title = "Approve Requests", Subtitle = "3 pending leave requests", IconSvg = approveIcon, IconBgCssClass = "bg-green-100", IconColorCssClass = "text-green-600", IsSelected = true },
            new ActionCardModel { Title = "Generate Report", Subtitle = "Payroll or attendance", IconSvg = reportIcon, IconBgCssClass = "bg-teal-100", IconColorCssClass = "text-teal-600" },
            new ActionCardModel { Title = "Portal Settings", Subtitle = "Manage permissions", IconSvg = settingsIcon, IconBgCssClass = "bg-slate-100", IconColorCssClass = "text-slate-600" }
        };
    }
}